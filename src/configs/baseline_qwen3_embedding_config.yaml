name: "qwen3_embedding_baseline"

model:
  model_name: "Qwen/Qwen3-Embedding-8B"
  hidden_size: 4096
  num_labels: 2
  head_dropout: 0.1

  # Two options only:
  # - use_lora: false → frozen embedding + trainable linear head only
  # - use_lora: true  → frozen embedding + trainable LoRA adapters + trainable linear head
  use_lora: true
  lora:
    r: 16
    lora_alpha: 16
    lora_dropout: 0.05
    bias: "none"
    target_modules:
      - q_proj
      - k_proj
      - v_proj
      - o_proj
      - gate_proj
      - up_proj
      - down_proj

pretrain:
  enabled: true
  # Keep this small for memory; 12k–16k contexts will OOM even with LoRA.
  max_length: 8192
  mlm_probability: 0.15
  # Adds a real [MASK] token if missing (removes warning and enables standard 80/10/10 masking)
  add_mask_token: true

wandb:
  enabled: true
  project: "Pretrain-Qwen3-8B-Pancreas-classification"
  run_name: "baseline-qwen3-embedding-6-month-two-stage"

training:
  output_dir: "/data/scratch/qc25022/pancreas_MEDS/experiments/baselines/qwen3_embedding_6_month-two-stage"
  overwrite_output_dir: true
  epochs: 1
  batch_size: 2
  eval_batch_size: 2
  learning_rate: 1e-5
  weight_decay: 0.01
  warmup_steps: 100
  gradient_accumulation_steps: 1
  gradient_checkpointing: true   # Saves memory when base is frozen (fewer activations stored)
  fp16: false
  bf16: true
  logging_steps: 50
  eval_steps: 250
  save_steps: 500
  save_total_limit: 2
  dataloader_num_workers: 4

data:
  cutoff_months: 6
  data_dir: "/data/scratch/qc25022/pancreas/tokenised_data_pancreas_MEDS/cprd_upgi"
  vocab_filepath: "/data/scratch/qc25022/pancreas/tokenised_data_pancreas_MEDS/cprd_upgi/vocab.csv"
  labels_filepath: "/data/home/qc25022/cancer-extraction-pipeline/output/pancreas_MEDS/subject_information.csv"
  medical_lookup_filepath: "/data/home/qc25022/TextCancEHR2/src/resources/MedicalDictTranslation2.csv"
  lab_lookup_filepath: "/data/home/qc25022/TextCancEHR2/src/resources/LabLookUP.csv"
  region_lookup_filepath: "/data/home/qc25022/TextCancEHR2/src/resources/RegionLookUp.csv"
  time_lookup_filepath: "/data/home/qc25022/TextCancEHR2/src/resources/TimeLookUp.csv"
  max_length: 12000
  handle_long_sequences: "warn"
  sort_by_length: true
